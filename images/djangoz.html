<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><p><img src="/work/python-project/zp/python/django/3.png" alt="3">MVC：模型-视图-控制器<br>目标：模型（数据）和视图（显示）解耦合</p>
<p>通过控制器，将数据和显示分离，好处是同一个视图可以加载不同的模型，同一个模型也可以显示成不同的视图</p>
<p>稍具规模的系统都会使用MVC架构或者它的变体（MVP、MVVM等）</p>
<p>它是对面向对象设计原则中迪米特法则的一个最好的践行</p>
<h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p>MIME类型  Multi-purpose - Internet - Mail - Extent</p>
<p><strong>Request Headers</strong></p>
<ul>
<li>请求行</li>
<li>请求头</li>
<li>空行</li>
<li>消息体</li>
</ul>
<p><strong>Response Headers</strong></p>
<ul>
<li>响应行</li>
<li>响应头</li>
<li>空行</li>
<li>消息体</li>
</ul>
<p>Ethereal 抓包 + 协议分析工具</p>
<p>WireShark 抓包工具 —&gt; 网卡 - 混杂模式</p>
<h3 id="创建Django项目"><a href="#创建Django项目" class="headerlink" title="创建Django项目"></a>创建Django项目</h3><p>Windows环境</p>
<pre><code class="bash">1. 创建虚拟环境, 目录名venv
    $ python -m venv venv  
2. 查看虚拟目录
    $ <span class="built_in">cd</span> venv 
3. 激活虚拟环境
    $ <span class="built_in">cd</span> Scripts 切换到脚本
    $ activate 激活 
4. 在虚拟环境安装django并指定版本号
    $ pip install django[==版本号] 
5. 查看django版本(可跳过此步骤)
    $ django-admin --version
6. 开启一个项目
    $ django-admin startproject hello_django .
7. 切换到hello_django目录
    $ <span class="built_in">cd</span> hello_django
10. 启动服务器
    $ python3 manage.py runserver
11. 开启一个应用, 应用名hrs
    $ python manage.py startapp hrs
</code></pre>
<p>MAC / Linux 环境</p>
<pre><code class="bash">1. 创建项目文件夹
    $ mkdir hello_django
2. 切换到项目目录
    $ <span class="built_in">cd</span> hello_django/
3. 使用venv模块创建虚拟环境，目录名venv
    <span class="comment"># pythonX 早期版本建虚拟环境</span>
    <span class="comment">#    $pip install virtualenv</span>
    <span class="comment"># pythonX -m irtualenv venv</span>
    $ python3 -m venv venv
4. 激活虚拟环境
    $ <span class="built_in">source</span> venv/bin/activate
5. 更新pip到最新版本(如果已经是最新版则跳过次步)
    $ python -m pip install --upgrade pip
6. 使用pip安装django
    $ pip install django
7. 通过安装django时安装的脚本工具django-admin检查django版本(可跳过此步骤)
    $ django-admin --version
8. 开启一个项目
    $ django-admin startproject hello_django .
9. 切换到hello_django目录
    $ <span class="built_in">cd</span> hello_django
10. 启动服务器
    $ python manage.py runserver
11. 开启一个应用, 应用名hrs
    $ python manage.py startapp hrs
</code></pre>
<pre><code class="python">
</code></pre>
<h3 id="链接数据库"><a href="#链接数据库" class="headerlink" title="链接数据库"></a>链接数据库</h3><p><strong>$ python manage.py shell 在项目内开启交互式环境</strong></p>
<ol>
<li>创建 / 删除 / 修改</li>
</ol>
<pre><code class="python"> <span class="comment"># 创建</span>
<span class="meta">&gt;&gt;&gt; </span>dept = Dept(no=<span class="string">'70'</span>,name=<span class="string">'运维部'</span>,location=<span class="string">'武汉'</span>)
<span class="meta">&gt;&gt;&gt; </span>dept.name
<span class="string">'运维部'</span>
<span class="meta">&gt;&gt;&gt; </span>dept.save() <span class="comment"># 保存对象 --&gt; 添加数据库 </span>

<span class="comment"># 删除</span>
<span class="meta">&gt;&gt;&gt; </span>dept = Dept.objects.get(pk=<span class="string">'50'</span>)
<span class="meta">&gt;&gt;&gt; </span>dept.delete()

<span class="comment"># 更新</span>
<span class="meta">&gt;&gt;&gt; </span>dept = Dept.objects.get(no=<span class="string">'50'</span>)
<span class="meta">&gt;&gt;&gt; </span>dept.name = <span class="string">'后勤1部'</span>
<span class="meta">&gt;&gt;&gt; </span>dept.save() 
</code></pre>
<ol start="2">
<li>查找</li>
</ol>
<pre><code class="python"><span class="comment"># filter 过滤</span>
<span class="meta">&gt;&gt;&gt; </span>dept = list(Dept.objects.filter(name=<span class="string">'运维部'</span>))
<span class="meta">&gt;&gt;&gt; </span>dept[<span class="number">0</span>]
&lt;Dept: 运维部&gt;
<span class="meta">&gt;&gt;&gt; </span>dept[<span class="number">0</span>].name
<span class="string">'运维部'</span>

<span class="comment"># 模糊查询 name__contains / name__icontains(忽略大小写)</span>
<span class="meta">&gt;&gt;&gt; </span>Dept.objects.filter(name__contains=<span class="string">'运维'</span>) 查询名字包含运维部门

<span class="comment"># no__gt / no__gte 大于/大于等于</span>
<span class="meta">&gt;&gt;&gt; </span>Dept.objects.filter(no__gt=<span class="string">'30'</span>) 查询部门编号大于<span class="number">30</span>的部门

<span class="comment"># all()查所有  </span>
<span class="comment"># order_by 排序 </span>
<span class="comment"># [0:3] 切片 [) 没有[-1]操作</span>
<span class="meta">&gt;&gt;&gt; </span>Dept.objects.all().order_by(<span class="string">'-no'</span>)[<span class="number">0</span>:<span class="number">3</span>]

<span class="comment"># 原生SQL语句查询</span>
<span class="meta">&gt;&gt;&gt; </span>Dept.objects.raw(<span class="string">'select name from tb_dept'</span>)

<span class="comment"># 查询关联表数据</span>
<span class="meta">&gt;&gt;&gt; </span>emp=Emp.objects.get(no=<span class="number">1</span>)
<span class="meta">&gt;&gt;&gt; </span>emp.dept.name
<span class="string">'总经办'</span>
<span class="meta">&gt;&gt;&gt; </span>emp.dept.location
<span class="string">'贵阳'</span>
</code></pre>
<h3 id="Git提示"><a href="#Git提示" class="headerlink" title="Git提示"></a>Git提示</h3><pre><code class="python">如果你使用 Git，很可能想把数据库文件纳入版本控制。这可不是个好主意，因为如果你与 别人协作的话，它们说不定会修改数据库，这会导致无穷尽的冲突。
正确的做法是把 db.sqlite3 添加到 .gitignore 文件中，在提交和推送时排除数据库文件。*.pyc 和设备专用的文件也应该忽略。
</code></pre>
<h2 id="配置Django项目流程"><a href="#配置Django项目流程" class="headerlink" title="配置Django项目流程"></a>配置Django项目流程</h2><ol>
<li><p>在虚拟环境安装django</p>
<p>pip install django  </p>
</li>
<li><p>创建一个应用</p>
<p>python manager.py startapp [name]</p>
<p>setting.py</p>
<pre><code class="python"><span class="comment"># 添加应用名</span>
INSTALLED_APPS = [
    <span class="string">'cars.apps.CarsConfig'</span>,
]
</code></pre>
</li>
<li><p>创建数据库</p>
<p>创建数据库, 并指定utf8字符集</p>
</li>
<li><p>配置数据库</p>
<p>settings.py</p>
<pre><code class="python">DATABASES = {
    <span class="string">'default'</span>: {
        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,
        <span class="string">'NAME'</span>: <span class="string">'cars'</span>,
        <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,
        <span class="string">'PORT'</span>: <span class="number">3306</span>,
        <span class="string">'USER'</span>: <span class="string">'root'</span>,
        <span class="string">'PASSWORD'</span>: <span class="string">'root'</span>,
    }
}

<span class="comment"># 输出数据库日志到控制台</span>
<span class="comment"># 日志级别为DEBUG 最详细的日志</span>
<span class="comment"># DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL</span>
LOGGING = {
    <span class="string">'version'</span>: <span class="number">1</span>,
    <span class="string">'disable_existing_loggers'</span>: <span class="keyword">False</span>,
    <span class="string">'handlers'</span>: {
        <span class="string">'console'</span>: {
            <span class="string">'class'</span>: <span class="string">'logging.StreamHandler'</span>,
        },
    },
    <span class="string">'loggers'</span>: {
        <span class="string">'django'</span>: {
            <span class="string">'handlers'</span>: [<span class="string">'console'</span>],
            <span class="string">'level'</span>: os.getenv(<span class="string">'DJANGO_LOG_LEVEL'</span>, <span class="string">'DEBUG'</span>),
        },
    },
}
</code></pre>
<p>应用目录 __init__.py</p>
<pre><code class="python"><span class="keyword">import</span> pymysql
pymysql.install_as_MySQLdb()
</code></pre>
</li>
<li><p>创建模型</p>
<p> models.py</p>
<pre><code class="python"><span class="keyword">from</span> django.db <span class="keyword">import</span> models

<span class="class"><span class="keyword">class</span> <span class="title">Record</span><span class="params">(models.Model)</span>:</span>

    no = models.AutoField(primary_key=<span class="keyword">True</span>,verbose_name=<span class="string">'编号'</span>)
    car_no = models.CharField(max_length=<span class="number">7</span>, verbose_name=<span class="string">'车牌号'</span>)
    cause = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">'违章原因'</span>)
    date = models.DateTimeField(auto_now_add=<span class="keyword">True</span>, verbose_name=<span class="string">'违章日期'</span>,db_column=<span class="string">'happen_date'</span>)
    way = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">'处罚方式'</span>)
    dispose = models.BooleanField(default=<span class="keyword">False</span>, verbose_name=<span class="string">'是否受理'</span>)

<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>
    <span class="keyword">return</span> self.car_no

<span class="comment"># 设置一个内部类 给表重命名</span>
<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span>
    db_table = <span class="string">'tb_car_record'</span>
    verbose_name_plural = <span class="string">'违章记录'</span>
    ordering = (<span class="string">'no'</span>, )
</code></pre>
</li>
<li><p>迁移数据库</p>
<p>$ python manage.py makemigrations hrs # 生成迁移<br>$ python manage.py migrate # 执行迁移</p>
</li>
<li><p>创建管理员</p>
<pre><code class="python">$ python manage.py createsuperuser
Username (leave blank to use <span class="string">'gavinliu'</span>): admin
Email address: <span class="number">18086869080</span>@<span class="number">163.</span>com
Password: liutc1014?
</code></pre>
</li>
<li><p>配置管理员界面</p>
<p>admin.py</p>
<pre><code class="python"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin
<span class="keyword">from</span> cars.models <span class="keyword">import</span> Record

<span class="class"><span class="keyword">class</span> <span class="title">RecordAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span>
    list_display = (<span class="string">'no'</span>, <span class="string">'car_no'</span>, <span class="string">'cause'</span>, <span class="string">'date'</span>, <span class="string">'way'</span>, <span class="string">'dispose'</span>)
    search_fields = (<span class="string">'car_no'</span>,)
    ordering = (<span class="string">'no'</span>,)

admin.site.register(Record, RecordAdmin)
</code></pre>
<p>其他设置</p>
<pre><code class="python">LANGUAGE_CODE = <span class="string">'zh-hans'</span> <span class="comment"># 设置中文</span>
TIME_ZONE = <span class="string">'Asia/Shanghai'</span> <span class="comment"># 设置时区</span>
DEBUG = <span class="keyword">False</span> 关闭调试模式
    如果想要远程访问
    DEBUG = <span class="keyword">True</span> 开启调试模式
    ALLOWED_HOSTS = [<span class="string">'*'</span>]
</code></pre>
</li>
</ol>
